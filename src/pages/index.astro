---
import Layout from "../layouts/main.astro";
import { Content } from "./info.md";
import "./style.css";
import "./info.css";
---

<Layout>
    <div id="app">
        <div id="statusBar" class="statusBar">
            <div id="status"></div>

            <div class="right">
                <div id="OptionsBtn" class="toggleBtn">
                    <span>Options</span>
                </div>

                <span>|</span>

                <div id="JuliaBtn" class="toggleBtn">
                    <span>Julia set</span>
                </div>

                <span>|</span>

                <a
                    id="gerhardLink"
                    class="colorChanger link"
                    href="https://gerhard.page"
                >
                    Built by Gerhard
                </a>

                <span>|</span>

                <div id="infoBtn" class="toggleBtn colorChanger">
                    <span>?</span>
                </div>
            </div>
        </div>

        <div id="canvasWrapper">
            <div id="info" class="minimized">
                <div id="infoBtnExit" class="exit colorChanger">x</div>
                <div class="feed">
                    <Content />
                    <p class="me">- written & built by Gerhard -</p>
                </div>
            </div>
            <canvas id="view"></canvas>
        </div>

        <div id="controls" class="appWindow colorChanger">
            <div id="controlsHeader" class="appHeader">
                <span class="appTitle">Options</span>
                <button class="appMinimize colorChanger" type="button">─</button
                >
            </div>

            <div class="appBody">
                <div class="row">
                    <label>
                        Color <input type="color" id="fc" />
                    </label>
                    <label>
                        Fill interior <input type="checkbox" id="fillInside" />
                    </label>
                </div>

                <div class="row">
                    <label>
                        Glow
                        <input
                            type="range"
                            id="mandelGlow"
                            min="0"
                            max="100"
                            value="80"
                        />
                    </label>

                    <label>
                        <label>
                            <button
                                id="normalize-mandel"
                                class="btn colorChanger">normalize</button
                            >
                        </label>
                    </label>
                </div>

                <div class="row">
                    <label>
                        Iterations
                        <input
                            class="colorChanger"
                            type="number"
                            id="mandelIterations"
                            value="200"
                        />
                    </label>
                </div>
            </div>
        </div>

        <div id="juliaBox" class="appWindow colorChanger">
            <div id="juliaHeader" class="appHeader">
                <span class="appTitle">Julia set</span>
                <button class="appMinimize colorChanger" type="button">─</button
                >
            </div>

            <div id="juliaContent" class="appBody">
                <canvas id="juliaCanvas"></canvas>

                <div class="juliaStatus">
                    <div id="juliaStatus">No web worker</div>
                    <div class="row">
                        <div id="juliaCoordinates">
                            Loading Julia-coordinates...
                        </div>
                        <button id="get" class="btn colorChanger"
                            >get cursor</button
                        >
                    </div>
                </div>

                <div class="row">
                    <label>
                        Glow
                        <input
                            type="range"
                            id="juliaGlow"
                            min="0"
                            max="100"
                            value="30"
                        />
                    </label>

                    <label>
                        <button id="normalize-julia" class="btn colorChanger"
                            >normalize</button
                        >
                    </label>
                </div>

                <div class="row">
                    <label>
                        Iterations
                        <input
                            class="colorChanger"
                            type="number"
                            id="juliaIterations"
                            value="500"
                        />
                    </label>
                </div>

                <div id="juliaResizeHandle" class="resizeHandle colorChanger">
                </div>
            </div>
        </div>

        <div id="juliaCursor" class="cursorWidget colorChanger">
            <div class="ver">
                <div class="line"></div><div class="line"></div>
            </div>
            <div class="hor">
                <div class="line"></div><div class="line"></div>
            </div>
        </div>
    </div>
</Layout>

<script is:inline src="/mandelbrot/ui-dom.js"></script>
<script is:inline src="/mandelbrot/fractal-helpers.js"></script>
<script is:inline src="/mandelbrot/mandel-set.js"></script>
<script is:inline src="/mandelbrot/julia-set.js"></script>
<script is:inline>
    // Patch worldToScreen to account for statusbar at top
    // Use getBoundingClientRect for accurate height including any scaling
    const _originalWorldToScreen = worldToScreen;
    worldToScreen = function(cx, cy) {
        const result = _originalWorldToScreen(cx, cy);
        const statusBar = document.getElementById('statusBar');
        const statusBarHeight = statusBar ? statusBar.getBoundingClientRect().height : 0;
        return { sx: result.sx, sy: result.sy + statusBarHeight };
    };
</script>
<script is:inline src="/mandelbrot/main.js"></script>
